<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¥´ë¥´ë•…ì˜ ìƒì¼ ì¼€ì´í¬ ë§Œë“¤ê¸°</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 15px;
    background: #ffe4f0;
    color: #880047;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(255, 192, 203, 0.6);
  }
  h1 {
    text-align: center;
    color: #d6336c;
    font-weight: 700;
    text-shadow: 1px 1px 3px #fcd1e8;
  }
  #container {
    display: flex;
    gap: 20px;
    margin-top: 15px;
  }
  #ingredients, #cakeArea {
    flex: 1;
    background: #fff0f6;
    padding: 15px;
    border-radius: 10px;
    border: 2px solid #d6336c;
    min-height: 300px;
  }
  #ingredients h2, #cakeArea h2 {
    color: #d6336c;
    margin-top: 0;
    text-align: center;
  }
  .ingredient {
    background: #f8c7da;
    border: 2px solid #d6336c;
    border-radius: 10px;
    padding: 10px;
    margin: 8px auto;
    width: 140px;
    text-align: center;
    cursor: grab;
    user-select: none;
    font-weight: 600;
  }
  .ingredient.dragging {
    opacity: 0.5;
  }
  #cakeDropZone {
    border: 2px dashed #d6336c;
    border-radius: 12px;
    height: 220px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #d6336c;
    font-weight: 600;
    text-align: center;
    padding: 10px;
  }
  #selectedList {
    margin-top: 15px;
    min-height: 50px;
  }
  #selectedList span {
    background: #f06292;
    color: white;
    padding: 5px 10px;
    margin: 4px;
    border-radius: 8px;
    display: inline-block;
    font-weight: 700;
    user-select: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #selectedList span:hover {
    background-color: #d6336c;
  }
  #cakeName, #couponCode {
    width: 100%;
    padding: 8px;
    font-size: 16px;
    margin-top: 12px;
    border: 2px solid #d6336c;
    border-radius: 8px;
  }
  button {
    background-color: #d6336c;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 18px;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 15px;
    width: 100%;
    box-shadow: 0 4px 6px rgba(214, 51, 108, 0.4);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #f783ac;
  }
  #result {
    margin-top: 20px;
    padding: 15px;
    background: #ffd6e8;
    border-radius: 10px;
    border: 2px solid #f06292;
    font-weight: 600;
    color: #880047;
    text-align: center;
    min-height: 50px;
  }
 
  #toggleRecipeBtn {
    background-color: #f06292;
    margin-bottom: 10px;
    width: auto;
  }

  #recipeModal {
    display: none; 
    position: fixed;
    z-index: 9999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(136, 0, 71, 0.7);
    backdrop-filter: blur(4px);
  }
  #recipeContent {
    background: #fff0f6;
    margin: 80px auto;
    padding: 20px;
    border-radius: 12px;
    max-width: 600px;
    max-height: 70vh;
    overflow-y: auto;
    border: 3px solid #d6336c;
    color: #880047;
  }
  #recipeContent h2 {
    margin-top: 0;
    color: #d6336c;
    text-align: center;
  }
  #recipeContent ul {
    list-style-type: none;
    padding-left: 0;
  }
  #recipeContent li {
    padding: 6px 8px;
    border-bottom: 1px dotted #d6336c;
  }
  #closeRecipeBtn {
    background-color: #d6336c;
    color: white;
    border: none;
    padding: 8px 15px;
    font-size: 14px;
    border-radius: 8px;
    cursor: pointer;
    float: right;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<h1>ë¥´ë¥´ë•…ì˜ ìƒì¼ ì¼€ì´í¬ ë§Œë“¤ê¸°</h1>

<button id="toggleRecipeBtn">ë ˆì‹œí”¼ ë„ê° ì—´ê¸°</button>

<div id="container">
  <div id="ingredients">
    <h2>ì¬ë£Œ ëª©ë¡ (ë“œë˜ê·¸)</h2>
    <div class="ingredient" draggable="true" data-name="ìë‘">ìë‘</div>
    <div class="ingredient" draggable="true" data-name="ìƒí¬ë¦¼">ìƒí¬ë¦¼</div>
    <div class="ingredient" draggable="true" data-name="ê¿€">ê¿€</div>
    <div class="ingredient" draggable="true" data-name="ì´ˆì½œë¦¿">ì´ˆì½œë¦¿</div>
    <div class="ingredient" draggable="true" data-name="ê³¼ì¼">ê°ì¢… ê³¼ì¼</div>
  </div>

  <div id="cakeArea">
    <h2>ì¼€ì´í¬ ë§Œë“¤ê¸° ê³µê°„</h2>
    <div id="cakeDropZone">ì—¬ê¸°ë¡œ ì¬ë£Œë¥¼ ë“œë¡­í•˜ì„¸ìš”!</div>
    <div id="selectedList" title="ì¬ë£Œ í´ë¦­ ì‹œ ì„ íƒ í•´ì œ"></div>
  </div>
</div>

<label for="cakeName">ì¼€ì´í¬ ì´ë¦„:</label>
<input type="text" id="cakeName" placeholder="ì¼€ì´í¬ ì´ë¦„ ì…ë ¥" />

<label for="couponCode">ì¿ í° ì½”ë“œ ì…ë ¥:</label>
<input type="text" id="couponCode" placeholder="ì¿ í° ì½”ë“œ ì…ë ¥" />

<button id="makeCakeBtn">ì¼€ì´í¬ ë§Œë“¤ê¸°</button>

<div id="result"></div>


<div id="recipeModal" role="dialog" aria-modal="true" aria-labelledby="recipeTitle">
  <div id="recipeContent">
    <button id="closeRecipeBtn">ë‹«ê¸° âœ•</button>
    <h2 id="recipeTitle">ë ˆì‹œí”¼ ë„ê°</h2>
    <ul id="recipesUl"></ul>
  </div>
</div>

<script>
  const secretIngredient = "ì£¼ë¥´ë¥´ ì¥ì‹";
  const couponCodeInput = document.getElementById('couponCode');
  const cakeDropZone = document.getElementById('cakeDropZone');
  const selectedList = document.getElementById('selectedList');
  const resultDiv = document.getElementById('result');
  const recipesUl = document.getElementById('recipesUl');
  const cakeNameInput = document.getElementById('cakeName');
  const makeCakeBtn = document.getElementById('makeCakeBtn');
  const ingredients = document.querySelectorAll('.ingredient');
  const toggleRecipeBtn = document.getElementById('toggleRecipeBtn');
  const recipeModal = document.getElementById('recipeModal');
  const closeRecipeBtn = document.getElementById('closeRecipeBtn');

  let selectedIngredients = [];
  let recipeLog = [];
  let endingsFound = new Set();


  ingredients.forEach(elem => {
    elem.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', e.target.dataset.name);
      e.target.classList.add('dragging');
    });
    elem.addEventListener('dragend', e => {
      e.target.classList.remove('dragging');
    });
  });


  cakeDropZone.addEventListener('dragover', e => {
    e.preventDefault();
  });
  cakeDropZone.addEventListener('drop', e => {
    e.preventDefault();
    const ingName = e.dataTransfer.getData('text/plain');
    if (selectedIngredients.includes(ingName)) return alert("â— ì´ë¯¸ ì„ íƒëœ ì¬ë£Œì…ë‹ˆë‹¤!");
    if (selectedIngredients.length >= 3) return alert("â— ì¬ë£ŒëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”!");
    selectedIngredients.push(ingName);
    renderSelected();
  });


  function renderSelected() {
    selectedList.innerHTML = '';
    selectedIngredients.forEach(ing => {
      const span = document.createElement('span');
      span.textContent = ing;
      span.title = "í´ë¦­í•˜ë©´ ì„ íƒ í•´ì œ";
      span.style.userSelect = "none";

      span.addEventListener('click', () => {
        selectedIngredients = selectedIngredients.filter(i => i !== ing);
        renderSelected();
      });
      selectedList.appendChild(span);
    });
  }


  couponCodeInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      applyCoupon(couponCodeInput.value.trim());
      couponCodeInput.value = '';
    }
  });

  function applyCoupon(code) {
  const lowerCode = code.toLowerCase();

  if (lowerCode === 'jururu') {
    if (!selectedIngredients.includes(secretIngredient)) {
      if (selectedIngredients.length >= 3) {
        alert("â— ì¬ë£ŒëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”!");
        return;
      }
      selectedIngredients.push(secretIngredient);
      renderSelected();
      alert("ğŸ‰ ë¹„ë°€ ì¬ë£Œ 'ì£¼ë¥´ë¥´ ì¥ì‹'ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } else {
      alert("â— ì´ë¯¸ ë¹„ë°€ ì¬ë£Œê°€ í¬í•¨ë˜ì–´ ìˆì–´ìš”!");
    }
  }

  else if (lowerCode === '0826') {
    if (!selectedIngredients.includes("ë§ˆìŠ¤í„°í”¼ìŠ¤ ë¥´ë¥´")) {
      if (selectedIngredients.length >= 3) {
        alert("â— ì¬ë£ŒëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”!");
        return;
      }
      selectedIngredients.push("ë§ˆìŠ¤í„°í”¼ìŠ¤ ë¥´ë¥´");
      renderSelected();
      alert("ğŸ‰ ë¹„ë°€ ì¬ë£Œ 'ë§ˆìŠ¤í„°í”¼ìŠ¤ ë¥´ë¥´'ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } else {
      alert("â— ì´ë¯¸ ì´ ë¹„ë°€ ì¬ë£Œê°€ í¬í•¨ë˜ì–´ ìˆì–´ìš”!");
    }
  }

  else if (lowerCode === 'ë¬´7ì¦ˆ') { // âœ… ìƒˆë¡œìš´ ì¿ í°
    if (!selectedIngredients.includes("ì„¸êµ¬ì˜ ê³ ì–‘ì´ ëª¨ì–‘ ì´ˆì½œë¦¿")) {
      if (selectedIngredients.length >= 3) {
        alert("â— ì¬ë£ŒëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”!");
        return;
      }
      selectedIngredients.push("ì„¸êµ¬ì˜ ê³ ì–‘ì´ ëª¨ì–‘ ì´ˆì½œë¦¿");
      renderSelected();
      alert("ğŸ‰ ë¹„ë°€ ì¬ë£Œ 'ì„¸êµ¬ì˜ ê³ ì–‘ì´ ëª¨ì–‘ ì´ˆì½œë¦¿'ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
    } else {
      alert("â— ì´ë¯¸ ì´ ë¹„ë°€ ì¬ë£Œê°€ í¬í•¨ë˜ì–´ ìˆì–´ìš”!");
    }
  }

  else {
    alert("âŒ ì˜ëª»ëœ ì¿ í° ì½”ë“œì…ë‹ˆë‹¤.");
  }
}

function judgeEnding(ings) {
  if (ings.includes("ì„¸êµ¬ì˜ ê³ ì–‘ì´ ëª¨ì–‘ ì´ˆì½œë¦¿")) return "ì„¸êµ¬ì—”ë”©"; // âœ… ì¶”ê°€

  if (ings.length === 1 && ings[0] === "ìë‘") return "ìë‘ì—”ë”©";
  if (ings.length === 1) return "ë°°ë“œì—”ë”©";

  if (ings.includes(secretIngredient)) return "íˆë“ ì—”ë”©";
  if (ings.includes("ë§ˆìŠ¤í„°í”¼ìŠ¤ ë¥´ë¥´")) return "ê°ë™ì—”ë”©";

  let sweetLevel = 0;
  let sourLevel = 0;

  ings.forEach(ing => {
    if (ing === "ê¿€") sweetLevel = Math.max(sweetLevel, 2);
    else if (ing === "ì´ˆì½œë¦¿") sweetLevel = Math.max(sweetLevel, 1);
    else if (ing === "ìë‘") sourLevel = Math.max(sourLevel, 2);
    else if (ing === "ê³¼ì¼") sourLevel = Math.max(sourLevel, 1);
  });

  if (sweetLevel === 2) return "ë…¸ë©€ì—”ë”©";
  else if (sweetLevel === 1 && sourLevel >= 1) return "ê·¹ì°¬ì—”ë”©";
  else if (sweetLevel <= 1 && sourLevel >= 1) return "ì¹­ì°¬ì—”ë”©";

  if (ings.length > 0) return "ë…¸ë©€ì—”ë”©";
  return "ë°°ë“œì—”ë”©";
}

const endingMessages = {
  "ê·¹ì°¬ì—”ë”©": "ì´ê±°, ë„ˆë¬´ ë§›ìˆë‹¤! ì™„ì „ ë‚´ ì·¨í–¥!",
  "ì¹­ì°¬ì—”ë”©": "ë§›ìˆë‹¤! ì¢€ í•˜ëŠ”ë°?",
  "ìë‘ì—”ë”©": "ì´ê±° ì™„ì „ ìë‘ì¼€ì´í¬ ì•„ëƒ? ê·€ì—¬ì›Œ!",
  "ë…¸ë©€ì—”ë”©": "ì¡°ê¸ˆ ë‹¬ê¸´ í•˜ì§€ë§Œ... ë§›ìˆë„¤",
  "ë°°ë“œì—”ë”©": "í ë¥´ë¥´... ë‚´ ì·¨í–¥ì€ ì•„ë‹ˆë‹¤.",
  "íˆë“ ì—”ë”©": "ì´ ì¥ì‹, ê½¤ ê·€ì—¬ìš´ê±¸? í ë¥´ë¥´... ì¡°ê¸ˆ ë¥´ë¥´ ë§ˆìŒì— ë“¤ì§€ë„?",
  "ê°ë™ì—”ë”©": "ë§ˆìŠ¤í„°í”¼ìŠ¤, ê¸°ì–µí•´ì£¼ëŠ”êµ¬ë‚˜? ë‚´ê°€ ì´ ìë¦¬ê¹Œì§€ ì˜¨ ê±´ í­ë„ ë•ë¶„ì´ì•¼.",
  "ì„¸êµ¬ì—”ë”©": "ì´ê±° ì„¸êµ¬ê°€ ê·¸ë¦°ê±°ì§€? ì—­ì‹œ, ì„¸êµ¬ì¼ì¤„ ì•Œì•˜ì–´."
};
  
  function saveRecipe(name, ings, ending) {
    const key = ings.slice().sort().join("+");
    if (recipeLog.some(r => r.key === key)) return;
    recipeLog.push({key, name, ings: ings.slice(), ending});
    endingsFound.add(ending);
    updateRecipeList();

    if (endingsFound.size === 6) {
      resultDiv.textContent += "ğŸ‰ ëª¨ë“  ì—”ë”©ì„ í•´ê¸ˆí–ˆì–´ìš”! ë¥´ë¥´ë•…ì´ ê°ë™ ë°›ì„ ê±°ì˜ˆìš”! ğŸ‚";
    }
  }

  function updateRecipeList() {
    recipesUl.innerHTML = "";
    recipeLog.forEach(r => {
      const li = document.createElement('li');
      li.textContent = `${r.name || "(ì´ë¦„ì—†ìŒ)"}: [${r.ings.join(", ")}] - ${endingMessages[r.ending] || r.ending}`;
      recipesUl.appendChild(li);
    });
  }

  makeCakeBtn.addEventListener('click', () => {
    resultDiv.textContent = "";

    if (selectedIngredients.length === 0) {
      alert("â— ì¬ë£Œë¥¼ ìµœì†Œ 1ê°œ ì„ íƒí•˜ì„¸ìš”!");
      return;
    }

    const cakeName = cakeNameInput.value.trim();
    const ending = judgeEnding(selectedIngredients);

    saveRecipe(cakeName, selectedIngredients, ending);

    resultDiv.textContent = endingMessages[ending];

    selectedIngredients = [];
    renderSelected();
    cakeNameInput.value = "";
    couponCodeInput.value = "";
  });

  toggleRecipeBtn.addEventListener('click', () => {
    recipeModal.style.display = 'block';
  });
  closeRecipeBtn.addEventListener('click', () => {
    recipeModal.style.display = 'none';
  });

  recipeModal.addEventListener('click', e => {
    if (e.target === recipeModal) {
      recipeModal.style.display = 'none';
    }
  });
</script>

</body>
</html>
